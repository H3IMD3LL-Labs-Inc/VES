{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "graphTooltip": 1,
  "panels": [
    {
      "type": "row",
      "title": "Ingestion & Parsing",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "Lines Read Total (rate/sec)",
      "gridPos": { "h": 7, "w": 8, "x": 0, "y": 1 },
      "targets": [
        {
          "expr": "rate(logcollector_lines_read_total[1m])",
          "legendFormat": "{{instance}}",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Log Parsing Duration (p95)",
      "gridPos": { "h": 7, "w": 8, "x": 8, "y": 1 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(logcollector_parse_duration_seconds_bucket[1m])) by (le))",
          "legendFormat": "p95",
          "refId": "A"
        }
      ]
    },
    {
      "type": "bargauge",
      "title": "Parse Failures (5m increase)",
      "gridPos": { "h": 7, "w": 8, "x": 16, "y": 1 },
      "options": {
        "reduceOptions": { "calcs": ["last"], "fields": "", "values": false },
        "orientation": "horizontal",
        "displayMode": "gradient",
        "showUnfilled": false,
        "thresholds": {
          "mode": "absolute",
          "steps": [
            { "color": "green", "value": null },
            { "color": "orange", "value": 5 },
            { "color": "red", "value": 10 }
          ]
        }
      },
      "targets": [
        {
          "expr": "increase(logcollector_parse_failures_total[5m])",
          "legendFormat": "failures",
          "refId": "A"
        }
      ]
    },

    {
      "type": "row",
      "title": "Buffer & Shipper",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 8 },
      "collapsed": false
    },
    {
      "type": "gauge",
      "title": "Buffer Utilization Ratio",
      "gridPos": { "h": 7, "w": 8, "x": 0, "y": 9 },
      "options": {
        "reduceOptions": { "calcs": ["last"], "fields": "", "values": false },
        "orientation": "horizontal",
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "min": 0,
        "max": 1,
        "thresholds": {
          "mode": "percentage",
          "steps": [
            { "color": "green", "value": null },
            { "color": "yellow", "value": 0.75 },
            { "color": "red", "value": 0.9 }
          ]
        }
      },
      "targets": [
        {
          "expr": "logcollector_buffer_utilization_ratio",
          "legendFormat": "ratio",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Buffer Flush Duration (p95)",
      "gridPos": { "h": 7, "w": 8, "x": 8, "y": 9 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(logcollector_buffer_flush_duration_seconds_bucket[1m])) by (le))",
          "legendFormat": "p95",
          "refId": "A"
        }
      ]
    },
    {
      "type": "bargauge",
      "title": "Buffer Flush Errors (5m increase)",
      "gridPos": { "h": 7, "w": 8, "x": 16, "y": 9 },
      "options": {
        "reduceOptions": { "calcs": ["last"], "fields": "", "values": false },
        "orientation": "horizontal",
        "displayMode": "gradient"
      },
      "targets": [
        {
          "expr": "increase(logcollector_buffer_flush_errors_total[5m])",
          "legendFormat": "flush errors",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Shipper Duration (p95)",
      "gridPos": { "h": 7, "w": 8, "x": 0, "y": 16 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(logcollector_ship_duration_seconds_bucket[1m])) by (le))",
          "legendFormat": "p95 ship",
          "refId": "A"
        }
      ]
    },
    {
      "type": "gauge",
      "title": "Shipper Queue Depth",
      "gridPos": { "h": 7, "w": 8, "x": 8, "y": 16 },
      "options": {
        "min": 0,
        "thresholds": {
          "mode": "absolute",
          "steps": [
            { "color": "green", "value": null },
            { "color": "yellow", "value": 50 },
            { "color": "red", "value": 100 }
          ]
        }
      },
      "targets": [
        {
          "expr": "logcollector_ship_queue_depth",
          "legendFormat": "depth",
          "refId": "A"
        }
      ]
    },
    {
      "type": "bargauge",
      "title": "Ship Failures (5m increase)",
      "gridPos": { "h": 7, "w": 8, "x": 16, "y": 16 },
      "targets": [
        {
          "expr": "increase(logcollector_ship_failures_total[5m])",
          "legendFormat": "ship failures",
          "refId": "A"
        }
      ]
    },

    {
      "type": "row",
      "title": "System Health & Lifecycle",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 23 },
      "collapsed": false
    },
    {
      "type": "stat",
      "title": "Collector Up Status",
      "gridPos": { "h": 6, "w": 6, "x": 0, "y": 24 },
      "options": {
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "thresholds": {
          "mode": "absolute",
          "steps": [
            { "color": "red", "value": 0 },
            { "color": "green", "value": 1 }
          ]
        }
      },
      "targets": [
        {
          "expr": "up{job=\"ves-logcollector\"}",
          "legendFormat": "up",
          "refId": "A"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Active Async Tasks",
      "gridPos": { "h": 6, "w": 6, "x": 6, "y": 24 },
      "targets": [
        {
          "expr": "logcollector_active_tasks",
          "legendFormat": "tasks",
          "refId": "A"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Dropped Logs",
      "gridPos": { "h": 6, "w": 6, "x": 12, "y": 24 },
      "targets": [
        {
          "expr": "logcollector_dropped_logs_total",
          "legendFormat": "dropped",
          "refId": "A"
        }
      ]
    },
    {
      "type": "bargauge",
      "title": "Shutdown Invocations & Restarts",
      "gridPos": { "h": 6, "w": 6, "x": 18, "y": 24 },
      "targets": [
        {
          "expr": "increase(logcollector_shutdown_invocations_total[5m])",
          "legendFormat": "shutdowns",
          "refId": "A"
        },
        {
          "expr": "increase(logcollector_restarts_total[10m])",
          "legendFormat": "restarts",
          "refId": "B"
        }
      ]
    }
  ],
  "refresh": "10s",
  "schemaVersion": 42,
  "style": "dark",
  "tags": ["ves", "logcollector", "observability"],
  "time": { "from": "now-6h", "to": "now" },
  "title": "VES Log Collector â€” Enhanced Observability",
  "uid": "ves-logcollector-enhanced",
  "version": 2
}
