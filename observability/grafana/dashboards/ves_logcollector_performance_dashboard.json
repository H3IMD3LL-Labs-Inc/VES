{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "type": "row",
      "title": "Ingestion & Parsing",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "collapsed": false,
      "panels": []
    },
    {
      "type": "timeseries",
      "title": "Lines Read Total (rate/sec)",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 1 },
      "targets": [
        {
          "expr": "rate(logcollector_lines_read_total[1m])",
          "legendFormat": "{{instance}}",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Log Parsing Duration (p95, seconds)",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 1 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(logcollector_parse_duration_seconds_bucket[1m])) by (le))",
          "legendFormat": "p95",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Parser Failures (rate/5m)",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 8 },
      "targets": [
        {
          "expr": "increase(logcollector_parse_failures_total[5m])",
          "legendFormat": "parse failures",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Parser Backpressure (p95, seconds)",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 8 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(logcollector_parse_backpressure_duration_seconds_bucket[1m])) by (le))",
          "legendFormat": "p95 backpressure",
          "refId": "A"
        }
      ]
    },

    {
      "type": "row",
      "title": "Buffer & Shipper",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 15 },
      "collapsed": false,
      "panels": []
    },
    {
      "type": "timeseries",
      "title": "Buffer Flush Duration (p95, seconds)",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 16 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(logcollector_buffer_flush_duration_seconds_bucket[1m])) by (le))",
          "legendFormat": "p95 flush",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Buffer Utilization Ratio",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 16 },
      "targets": [
        {
          "expr": "logcollector_buffer_utilization_ratio",
          "legendFormat": "utilization",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Buffer Size (logs)",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 23 },
      "targets": [
        {
          "expr": "logcollector_buffer_size",
          "legendFormat": "buffer size",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Shipper Duration (p95, seconds)",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 23 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(logcollector_ship_duration_seconds_bucket[1m])) by (le))",
          "legendFormat": "p95 ship",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Shipper Queue Depth",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 30 },
      "targets": [
        {
          "expr": "logcollector_ship_queue_depth",
          "legendFormat": "queue depth",
          "refId": "A"
        }
      ]
    },

    {
      "type": "row",
      "title": "Throughput & Latency",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 37 },
      "collapsed": false,
      "panels": []
    },
    {
      "type": "timeseries",
      "title": "Throughput (logs/sec)",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 38 },
      "targets": [
        {
          "expr": "logcollector_throughput_logs_per_sec",
          "legendFormat": "{{instance}}",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "End-to-End Latency (p99, ms)",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 38 },
      "targets": [
        {
          "expr": "logcollector_p99_latency_ms",
          "legendFormat": "{{instance}}",
          "refId": "A"
        }
      ]
    },

    {
      "type": "row",
      "title": "Reliability & Failures",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 45 },
      "collapsed": false,
      "panels": []
    },
    {
      "type": "timeseries",
      "title": "Buffer Flush Errors (5m increase)",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 46 },
      "targets": [
        {
          "expr": "increase(logcollector_buffer_flush_errors_total[5m])",
          "legendFormat": "flush errors",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Shipping Failures (5m increase)",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 46 },
      "targets": [
        {
          "expr": "increase(logcollector_ship_failures_total[5m])",
          "legendFormat": "ship failures",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Dropped Logs (total)",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 53 },
      "targets": [
        {
          "expr": "logcollector_dropped_logs_total",
          "legendFormat": "dropped logs",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Average Batch Size",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 53 },
      "targets": [
        {
          "expr": "logcollector_average_batch_size",
          "legendFormat": "batch size",
          "refId": "A"
        }
      ]
    },

    {
      "type": "row",
      "title": "System & Lifecycle",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 60 },
      "collapsed": false,
      "panels": []
    },
    {
      "type": "timeseries",
      "title": "CPU Usage (%)",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 61 },
      "targets": [
        {
          "expr": "(100 - (avg by (instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[1m])) * 100))",
          "legendFormat": "CPU %",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Memory Usage (%)",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 61 },
      "targets": [
        {
          "expr": "(node_memory_Active_bytes / node_memory_MemTotal_bytes) * 100",
          "legendFormat": "Memory %",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Active Async Tasks",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 68 },
      "targets": [
        {
          "expr": "logcollector_active_tasks",
          "legendFormat": "active tasks",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Shutdown Invocations & Restarts",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 68 },
      "targets": [
        {
          "expr": "increase(logcollector_shutdown_invocations_total[5m])",
          "legendFormat": "shutdowns",
          "refId": "A"
        },
        {
          "expr": "increase(logcollector_restarts_total[10m])",
          "legendFormat": "restarts",
          "refId": "B"
        }
      ]
    },

    {
      "type": "row",
      "title": "Availability",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 75 },
      "collapsed": false,
      "panels": []
    },
    {
      "type": "timeseries",
      "title": "Collector Up Status",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 76 },
      "targets": [
        {
          "expr": "up{job=\"ves-logcollector\"}",
          "legendFormat": "up (1=OK)",
          "refId": "A"
        }
      ]
    }
  ],
  "refresh": "10s",
  "schemaVersion": 42,
  "style": "dark",
  "tags": ["ves", "logcollector", "observability"],
  "templating": { "list": [] },
  "time": { "from": "now-6h", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "VES Log Collector Full Observability",
  "uid": "ves-logcollector-full",
  "version": 1
}
