groups:
  - name: ves-logcollector-performance
    interval: 10s
    rules:
      # Low Throughput
      - alert: LowThroughput
        expr: logcollector_throughtput_logs_per_sec < 800000
        for: 30s
        labels:
          severity: warning
          category: performance
        annotations:
          summary: "Low Throughput detected (<800k logs/sec/core)"
          description: "Sustained throughput dropped below 800k logs/sec/core for over 30s."

      # High Average Latency
      - alert: HighAverageLatency
        expr: (rate(logcollector_process_line_duration_seconds_sum[1m]) / rate(logcollector_process_line_duration_seconds_count[1m]) * 1000 > 0.3
        for: 1m
        labels:
          severity: warning
          category: latency
        annotations:
          summary: "Average latency exceeds 0.3ms"
          description: "Average log processing latency exceeded 0.3ms (P99 <1ms expected)."

      # High P99 Latency
      - alert: HighP99Latency
        expr: logcollector_p99_latency_ms > 1
        for: 30s
        labels:
          severity: warning
          category: latency
        annotations:
          summary: "P99 latency above 1ms"
          description: "99th percentile latency exceeded 1ms threshold."

      # High Memory Footprint
      - alert: HighMemoryUsage
        expr: (logcollector_memory_bytes / 1024 / 1024) > 45
        for: 2m
        labels:
          severity: warning
          category: memory
        annotations:
          summary: "Memory footprint above 45MB"
          description: "Memory usage exceeded 45MB under sustained load."

      # High CPU Usage
      - alert: HighCPUUsage
        expr: logcollector_cpu_percent_per_core > 25
        for: 1m
        labels:
          severity: warning
          category: cpu
        annotations:
          summary: "CPU Usage per core above 25%"
          description: "CPU Utilization exceeded 25% per core threshold."

      # Slow Cold Start
      - alert: SlowColdStart
        expr: logcollector_startup_duration_seconds * 1000 > 80
        for: 30s
        labels:
          severity: warning
          category: startup
        annotations:
          summary: "Cold start too slow (>80ms)"
          description: "Startup time exceeded 80ms. Check initialization bottlenecks."

      # Slow Snapshot Recovery
      - alert: SlowSnapshotRecovery
        expr: logcollector_snapshot_recovery_duration_seconds * 1000 > 350
        for: 30s
        labels:
          severity: warning
          category: recovery
        annotations:
          summary: "Snapshot recovery slower than expected (>350ms)"
          description: "Snapshot restoration exceeded 350ms threshold â€” verify storage latency."
